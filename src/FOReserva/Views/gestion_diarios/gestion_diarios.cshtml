@model FOReserva.Models.Diarios.CDiarioModel

<div class="heading-title">
    <h3><span>Diarios de Viaje</span></h3>
</div>
@*<div class="row text-center">
        <a href="#"><button type="button" class="btn btn-default btn-lg"><i class="fa fa-book"></i>Crear un Diario de Viaje</button></a>
    </div>*@
<div class="panel">
@using (Html.BeginForm("buscarDiarios", "gestion_diarios", null, FormMethod.Post, new { @id = "formBuscarDiarios", @class = "form-horizontal" }))
{
    <fieldset>

        <input type="hidden" name="action" value="contact_send" />

        <div class="row">
            <div class="form-group">
                <div class="col-sm-12">
                    <label>Nombre</label>
                    @Html.TextBoxFor(m => m.Nombre, null, new { @id = "nombreD", @class = "form-control required", @name = "diario[prueba]", @placeholder = "Buscar por nombre" })
                </div>
                <div id="prueba_null" style="display: none;" class="has-error error col-sm-12">
                    <p><i class="fa fa-times-circle" aria-hidden="true"></i> Escribir Texto</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <div class="col-sm-12">
                    <label>Rango de fechas</label>
                    <input id="rf" type="text" class="form-control" name="rangofecha" value="" readonly />
                    
                </div>
                
                <!--Script para el selector de fechas-->
                <script type="text/javascript">
                    //función para inicializar y dar formato
                    $('input[name="rangofecha"]').daterangepicker({
                        locale: {
                            format: "DD/MM/YYYY",
                            applyLabel: "Aplicar",
                            cancelLabel: "Cancelar",
                            fromLabel: "Desde",
                            toLabel: "Hasta",
                            linkedCalendars: false,
                            showDropdowns: true,
                            autoApply: true,
                            daysOfWeek: [
                                "Do",
                                "Lu",
                                "Ma",
                                "Mi",
                                "Ju",
                                "Vi",
                                "Sa"
                            ],
                            monthNames: [
                                "Enero",
                                "Febrero",
                                "Marzo",
                                "Abril",
                                "Mayo",
                                "Junio",
                                "Julio",
                                "Agosto",
                                "Septiembre",
                                "Octubre",
                                "Noviembre",
                                "Diciembre"
                            ],
                            firstDay: 1
                        },
                        minDate: "31/12/2000",
                        maxDate: "@DateTime.Today.ToString("dd/MM/yyyy")",
                        startDate: "@DateTime.Today.AddYears(-1).ToString("dd/MM/yyyy")",
                        endDate: "@DateTime.Today.ToString("dd/MM/yyyy")"

                    });
                    //Actualizar los input que se usarán en el modelo
                    $("#rf").on('hide.daterangepicker', function () {
                        var drp = $('#rf').data('daterangepicker');
                        $("#f_ini").val(drp.startDate.format('YYYY-MM-DD')),
                        $("#f_fin").val(drp.endDate.format('YYYY-MM-DD'))
                    });

                </script>

                <!--Inputs ocultos de fechas para el formulario-->
                <div>
                    @Html.TextBoxFor(m => m.Fecha_ini, null, new { @id = "f_ini", @class = "form-control required", @name = "diario[f_inicio]", @type = "hidden", @value = "" })
                </div>
                <div>
                    @Html.TextBoxFor(m => m.Fecha_fin, null, new { @id = "f_fin", @class = "form-control required", @name = "diario[f_fin]", @type = "hidden", @value = "" })
                </div>
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <div class="col-sm-12">
                    <label>Lugares</label>
                    @Html.DropDownListFor(m => m.Lugar, Model.diariosLugares(), new { @class="col-md-12" })  
                    @*<select name="list_lugar "id="list_lugar" class="form-control">
                        <option value="0">------ Buscar por destino de viaje ------</option>
                        @foreach (var lug in Model.diariosLugares())
                        {
                        <option value="@lug.ID">@(lug.Tipo.Equals("pais")?"":"  --- ")@lug.Nombre</option>
                        }
                    </select>*@
                </div>
            </div>
        </div>

    </fieldset>

<div class="row text-center">
    <div class="col-md-12">
        <button type="button" id="buscarDiarios" class="btn btn-primary"><i class="fa fa-search"></i>Buscar</button>
    </div>
</div>
<script>
    //Unificación del jQuery para búsqueda. ESTO SE PONDRÁ EN UN .js
    function buscar(a) {
        a.preventDefault();
        var form = $("#formBuscarDiarios");
        alert("en buscar");
        $.ajax({
            url: "gestion_diarios/buscarDiarios",
            data: form.serialize(),
            type: 'POST',
            success: function (data) {
                alert("en ajax success");
                $(".error").hide();
                $("#nombreD").removeClass("has-error");
                $("#f_ini").removeClass("has-error");
                $("#f_fin").removeClass("has-error");
                var texto = $("#nombreD").val();
                var inicio = $("#f_ini").val();
                var fin = $("#f_fin").val();
         
                var win = true;

                if (texto == "" || texto == undefined) {
                    $("#nombreD").addClass("has-error");
                    $("#prueba_null").fadeIn();
                    win = false;
                }                

                if (win) {
                    
                    return true;
                }
                else
                    alert(data);
                
                //$('#formBuscarVuelos')[0].reset();
            }
        });
    }

    $("#buscarDiarios").click(function (e) { buscar(e) });      //Evento de click en el botón Buscar
    $("#formBuscarDiarios").submit(function (e) { buscar(e) }); //Evento general de submit (ej. presionar ENTER)

    jQuery(document).ready(function () {

        $("#f_ini").val("@DateTime.Today.ToString("yyyy-MM-dd")");
        $("#f_fin").val("@DateTime.Today.AddYears(-1).ToString("yyyy-MM-dd")");
        var url = '/gestion_diarios/gestion_diarios_resultados';
        var method = 'GET';
        var data = '';
        $("#resultados").html('<div class="text-center">Cargando...</div>')
        $.ajax(
            {
                url: url,
                type: method,
                data: data,
                dataType: "html",
                success: function (data, textStatus, jqXHR) {

                    $("#resultados").empty();
                    $("#resultados").html(data);


                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
    });
</script>
}
</div>

<hr/>

<section>
    <div id="resultados" class="container">
    
        <div class="row">
            <!-- item -->
            <div class="col-md-1">
                <!-- company logo -->
                <img src="@Url.Content("~/Content/assets/images/noimage.jpg")" class="img-responsive img-thumbnail" alt="company logo">
            </div>
            <div class="col-md-4">
                <!-- company detail -->
                <h4 class="margin-bottom-10"><font color="black">Nombre</font></h4>
                <p>Descripcion</p>
                <button type="button" class="btn btn-primary">Ver el Diario Completo</button>
                <a href="#" class="text-success"><i class="fa fa-thumbs-up"></i> Like</a> <a href="#" class="text-danger"><i class="fa fa-thumbs-down"></i> Dislike</a>
            </div>
        </div><!-- /item -->

        <hr />
    
    </div>
</section>
